ggplot(aes(x, y)) +
geom_bar(stat = "identity", aes(fill = x)) +
theme_bw() +
theme(legend.position = "top")
"Trung tam kinh doanh my pham va dich vu),
data <- data.frame(x = c("Trung tam kinh doanh dien tu dien may va do gia dung",
"Trung tam 2",
"Trung tam kinh doanh my pham va dich vu"),
y = c(5,3,7))
data <- data.frame(x = c("Trung tam kinh doanh dien tu dien may va do gia dung",
"Trung tam 2",
"Trung tam kinh doanh my pham va dich vu"),
y = c(5,3,7))
# Vẽ biểu đồ thông thường, không xử lỹ với factor
data %>%
ggplot(aes(x, y)) +
geom_bar(stat = "identity", aes(fill = x)) +
theme_bw() +
theme(legend.position = "top") +
ggtitle("")
ggtitle("Ví dụ 2")
data %>%
ggplot(aes(x, y)) +
geom_bar(stat = "identity", aes(fill = x)) +
theme_bw() +
theme(legend.position = "top") +
scale_x_discrete(labels = str_wrap(levels(data$x), width = 20)) +
ggtitle("Ví dụ 2")
library(stringr)
data %>%
ggplot(aes(x, y)) +
geom_bar(stat = "identity", aes(fill = x)) +
theme_bw() +
theme(legend.position = "top") +
scale_x_discrete(labels = str_wrap(levels(data$x), width = 20)) +
ggtitle("Ví dụ 2")
# Vẽ biểu đồ thông thường, không xử lý với factor
data %>%
ggplot(aes(x, y)) +
geom_bar(stat = "identity", aes(fill = x)) +
theme_bw() +
theme(legend.position = "none") +
ggtitle("Ví dụ 1")
data %>%
ggplot(aes(x, y)) +
geom_bar(stat = "identity", aes(fill = x)) +
theme_bw() +
theme(legend.position = "none") +
scale_x_discrete(labels = str_wrap(levels(data$x), width = 20)) +
ggtitle("Ví dụ 2")
.libPaths()
blogdown:::serve_site()
blogdown:::serve_site()
7 +8
servr::daemon_stop("293649272")
1.590.000 * 12
1590000 * 12
blogdown:::serve_site()
servr::daemon_stop("2294906310648")
7 * 7
blogdown:::serve_site()
blogdown:::new_post_addin()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
900/4*3
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
library(dplyr)
library(ggplot2)
library(forcats)
# Sử dụng dữ liệu airquality có sẵn trong R
data("airquality")
airquality %>% str
airquality %>% summary
airquality$Month <- airquality$Month %>%
as.factor
airquality$Month %>% class
levels(airquality$Month)
airquality$Month <- fct_recode(airquality$Month,
May = '5',
June = '6',
July = '7',
August = '8',
September = '9')
levels(airquality$Month)
library(ggplot2)
airquality %>%
ggplot(aes(Month, Temp)) +
geom_boxplot(aes(fill = Month)) +
ggtitle(label = "Daily Temperatures Aggregated by Month") +
theme_bw()
airquality$Month <- fct_relevel(airquality$Month, 'September', 'July', 'May', 'August', 'June')
levels(airquality$Month)
airquality %>%
ggplot(aes(Month, Temp)) +
geom_boxplot(aes(fill = Month)) +
ggtitle(label = "Notice how the order of the level 'Month' has changed") +
theme_bw()
airquality %>%
ggplot(aes(x = fct_reorder(Month, Temp, .desc = F), y = Temp)) +
geom_boxplot(aes(fill = Month)) +
labs(title = "We can make better comparison\n by reordering the levels based on the temperature values!") +
theme_bw() +
theme(plot.title = element_text(size = 10, face = 'bold'))
airquality %>%
ggplot(aes(x = fct_reorder(Month, Temp, .desc = F), y = Temp)) +
geom_boxplot(aes(fill = Month)) +
labs(title = "We can make better comparison\n by reordering the levels based on the temperature values!",
x = "Month") +
theme_bw() +
theme(plot.title = element_text(size = 10, face = 'bold'))
airquality %>%
ggplot(aes(x = fct_reorder(Month, Temp, .desc = F), y = Temp)) +
geom_boxplot(aes(fill = Month)) +
labs(title = "We can make better comparison",
subtitle = "by reordering the levels based on the temperature values!",
x = "Month") +
theme_bw() +
theme(plot.title = element_text(size = 10, face = 'bold'))
airquality %>%
ggplot(aes(x = fct_reorder(Month, Temp, .desc = F), y = Temp)) +
geom_boxplot(aes(fill = Month)) +
labs(title = "We can make better comparison",
subtitle = "by reordering the levels based on the temperature values!",
x = "Month") +
theme_bw() +
theme(plot.title = element_text(size = 12, face = 'bold'))
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::new_post_addin()
library(tidyverse)
theme_set(theme_bw)
theme_set(theme_bw())
# Tạo biểu đồ cơ bản
p <- ggplot(cars, aes(x = speed, y = dist)) +
geom_point(col = "navy")
p
# dollar
p + scale_y_continuous(labels = dollar)
library(scales)
p + scale_y_continuous(labels = percent)
# dollar
p + scale_y_continuous(labels = dollar)
p + scale_y_continuous(labels = scientific)
df <- data.frame(
date = seq(10000, 10700, by = 1) %>% lubridate::as_date(),
price = runif(50)
)
df <- data.frame(
date = seq(10000, 10700, by = 1) %>% lubridate::as_date(),
price = runif(701)
)
df <- df[order(df$date), ]
head(df)
df <- data.frame(
date = seq(10000, 10700, by = 1) %>% lubridate::as_date(),
price = runif(701)*12
)
head(df)
head(df)
df <- data.frame(
date = seq(13000, 13700, by = 1) %>% lubridate::as_date(),
price = runif(701)*12
)
head(df)
p2 <- ggplot(data=df,
aes(x=date, y=price)) + geom_line()
p2
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*12
)
head(df)
p2 <- ggplot(data=df,
aes(x=date, y=price)) + geom_line()
p2
# Format : tháng/ngày
p2 + scale_x_date(labels = date_format("%m/%d")) +
theme(axis.text.x = element_text(angle=45))
# Format : tháng/ngày
p2 +
scale_x_date(labels = date_format("%m/%d"))
# Format : tuần
p2 + scale_x_date(labels = date_format("%W"))
# Format: Chỉ tháng
p2 + scale_x_date(breaks = date_breaks("months"),
labels = date_format("%b"))
# Format: Chỉ tháng
p2 + scale_x_date(breaks = date_breaks("months"),
labels = date_format("%b/%y"))
# Format: Chỉ tháng
p2 + scale_x_date(breaks = date_breaks("months"),
labels = date_format("%b,%y"))
# Format : tuần
p2 + scale_x_date(labels = date_format("%W"))
# Format : tuần
p2 + scale_x_date(labels = date_format("%w"))
# Format : tháng/ngày
p2 + scale_x_date(labels = date_format("%m/%d"))
# Format : tháng/ngày
p2 + scale_x_date(labels = date_format("%d%m%y"))
# Format : tháng/ngày
p2 + scale_x_date(labels = date_format("%d/%m/%y"))
# Format : tháng/ngày
p2 + scale_x_date(breaks = date_breaks("months"),
labels = date_format("%d/%m/%y"))
# Format : tháng/ngày
p2 + scale_x_date(breaks = date_breaks("quarters"),
labels = date_format("%d/%m/%y"))
# Format : tháng/ngày
p2 + scale_x_date(breaks = date_breaks("quarter"),
labels = date_format("%d/%m/%y"))
# Format : tháng/ngày
p2 + scale_x_date(breaks = date_breaks("year"),
labels = date_format("%d/%m/%y"))
# Format : tháng/ngày
?date_breaks
p2 + scale_x_date(breaks = date_breaks("month"),
labels = date_format("%d/%m/%y"))
# Format : tháng/ngày
p2 + scale_x_date(breaks = date_breaks("month"),
labels = date_format("%m/%y"))
# Format : tháng/ngày
p2 + scale_x_date(breaks = date_breaks("month"),
labels = date_format("%m%y"))
# Format : tháng/ngày
p2 + scale_x_date(breaks = date_breaks("month"),
labels = date_format("%m/%y"))
# Format: tháng, năm - hiển thị ký tự tiếng Anh
p2 + scale_x_date(breaks = date_breaks("months"),
labels = date_format("%b,%y"))
?date
?date_format
?strptime
p2 <- ggplot(data=df,
aes(x=date, y=price)) +
geom_line(col = "darkblue")
p2
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*12 * cos(date)
)
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*12 * cos(as.numeric(date))
)
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*12 * cos(as.numeric(date))
)
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*12 * cos(rnorm(1))
)
head(df)
p2 <- ggplot(data=df,
aes(x=date, y=price)) +
geom_line(col = "darkblue")
p2
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = runif(201) * 10 * (cos(date))^2)
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = runif(201) * 10 * (cos(as.numeric(date)))^2)
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = runif(201) * 10 * (cos(as.numeric(date)))^2)
head(df)
p2 <- ggplot(data=df,
aes(x=date, y=price)) +
geom_line(col = "darkblue")
p2
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = runif(201) * 10 * cos(as.numeric(date)))
head(df)
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = runif(201) * 10 * cos(as.numeric(date)))
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = runif(201) * 10 * cos(as.numeric(date)))
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = runif(201) * 10 * cos(as.numeric(date)))
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = 10*cos(as.numeric(date)))
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = 10*cos(as.numeric(date))))
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = 10*cos(as.numeric(date)))
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = 100*cos(date))
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = 100*cos(as.numeric(date)))
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date()) %>%
mutate(price = 100*cos(as.numeric(date)))
head(df)
p2 <- ggplot(data=df,
aes(x=date, y=price)) +
geom_line(col = "darkblue")
p2
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*1)
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*1)
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*1)
head(df)
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*1)*abs(rnorm(201,0,1))
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*1)*abs(rnorm(201,0,1)))
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*1)*abs(rnorm(201,0,1)))
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*10)
head(df)
df <- data.frame(
date = seq(13000, 13200, by = 1) %>% lubridate::as_date(),
price = runif(201)*10*abs(rnorm(201,0,1)))
head(df)
p2 <- ggplot(data=df,
aes(x=date, y=price)) + geom_line()
p2
p2 <- ggplot(data=df,
aes(x=date, y=price)) +
geom_line(col = "darkblue")
p2
blogdown:::serve_site()
blogdown:::new_post_addin()
blogdown:::serve_site()
blogdown:::serve_site()
# Loading package
library(dplyr)
library(ggplot2)
# Sử dụng dữ liệu "iris" có sẵn trong R
data("iris")
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot()
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot() +
labs(title = "Overview of Iris Petal Length by Species",
x = "Species",
y = "Petal Length (cm)") +
scale_y_continuous(breaks = seq(0,10, by = 0.5))
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot() +
labs(title = "Overview of Iris Petal Length by Species",
x = "Species",
y = "Petal Length (cm)") +
scale_y_continuous(breaks = seq(0,10, by = 0.5))
Như vậy, chúng ta có thể hiểu biểu đồ trên mô tả tổng quan về độ dài cánh hoa (đơn vị: cm) của 3 loài hoa khác khau (setosa, versicolor, virginica).
# geom_text()
Tiếp theo, giả sử chúng ta muốn thêm và visualize thông tin về độ dài trung bình cánh hoa của 3 loài hoa trên, chúng ta thêm ``+`` ``geom_text()``.
Trong trường hợp này, chúng ta sẽ biểu diễn độ dài trung bình cánh hoa của các loài hoa bằng những điểm màu đỏ tương ứng trên biểu đồ, ``+`` ``geom_point()`` để vẽ biểu đồ điểm.
```{r}
# Tạo thêm 1 dataframe tính độ dài trung bình cánh hoa của các loài hoa
mean_sepal_length_by_species <- iris %>%
group_by(Species) %>%
summarise(mean_sepal_length = mean(Sepal.Length)) %>%
as.data.frame
---
title: "Vẽ biểu đồ boxplot đẹp trong GGPLOT2"
author: "Nguyễn Hải Trường"
date: "2018-09-02"
categories:
- Data Vizualization
tags:
- ggplot2
summary: "Xử lý dữ liệu chuỗi với stringR"
banner: "img/banners/banner-17.jpg"
---
Trong quá trình phân tích dữ liệu, ngoài việc đưa ra những con số thống kê "khô khan" chúng ta cần phải minh họa những con số bằng những hình vẽ hoặc biểu đồ để thu hút người đọc khi trình bày với đơn vị kinh doanh hay đối tác.
Như các bạn đã biết, package ``ggplot2`` trong ``R`` có thể giúp chúng ta "visualize" một cách dễ dàng và đẹp mắt, hay nói cách khác là biến những con số "khô khan" thành những con số biết nói. Trong bài viết này, ``Ranalytics`` sẽ hướng dẫn các bạn một số **tips** để visualize biểu đồ/hình vẽ của bạn một cách đẹp mắt hơn.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
```
```{r, warning=F, message=F}
# Loading package
library(dplyr)
library(ggplot2)
```
Ví dụ chúng ta vẽ 1 biểu đồ boxplot đơn giản như sau:
```{r}
# Sử dụng dữ liệu "iris" có sẵn trong R
data("iris")
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot()
```
# labs()
Trong trường hợp này, đầu tiên chúng ta cần thêm tiêu đề biểu đồ, thay đổi tiêu đề trục (X,Y) để người đọc có thể hiểu biểu đồ của chúng ta đang mô tả điều gì, chúng ta thêm ``+`` ``labs()``.
Ngoài ra, chúng ta cũng nên chia nhỏ các mốc giá trị trên trục Y (biến số Petal.Length) để người đọc có thể dễ dàng ước lượng được các giá trị quantile 25, median, quantile 75 của biến X (Species) một cách tương đối. Chúng ta thêm ``+`` ``scale_y_continuous()``.
```{r}
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot() +
labs(title = "Overview of Iris Petal Length by Species",
x = "Species",
y = "Petal Length (cm)") +
scale_y_continuous(breaks = seq(0,10, by = 0.5))
```
Như vậy, chúng ta có thể hiểu biểu đồ trên mô tả tổng quan về độ dài cánh hoa (đơn vị: cm) của 3 loài hoa khác khau (setosa, versicolor, virginica).
# geom_text()
Tiếp theo, giả sử chúng ta muốn thêm và visualize thông tin về độ dài trung bình cánh hoa của 3 loài hoa trên, chúng ta thêm ``+`` ``geom_text()``.
Trong trường hợp này, chúng ta sẽ biểu diễn độ dài trung bình cánh hoa của các loài hoa bằng những điểm màu đỏ tương ứng trên biểu đồ, ``+`` ``geom_point()`` để vẽ biểu đồ điểm.
```{r}
# Tạo thêm 1 dataframe tính độ dài trung bình cánh hoa của các loài hoa
mean_sepal_length_by_species <- iris %>%
group_by(Species) %>%
summarise(mean_sepal_length = mean(Sepal.Length)) %>%
as.data.frame
# Xem dữ liệu được tổng hợp
mean_sepal_length_by_species
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot() +
labs(title = "Overview of Iris Petal Length by Species",
x = "Species",
y = "Petal Length (cm)") +
scale_y_continuous(breaks = seq(0,30, by = 0.5)) +
geom_point(aes(x = Species,
y = round(mean_sepal_length,1)),
data = mean_sepal_length_by_species,
col = "red") +
geom_text(aes(label = round(mean_sepal_length,1),
x = Species,
y = round(mean_sepal_length,1)),
data = mean_sepal_length_by_species,
check_overlap = TRUE,
vjust = -0.5)
```
Như vậy, chúng ta thấy giá trị trung bình độ dài cánh hoa của 2 loài hoa (setose & versicolor) xấp xỉ bằng giá trị trung vị, trong khi đó đối với loài hoa virginica thì giá trị trung bình độ dài cánh hoa lớn hơn 1 chút so với giá trị trung vị.
# theme()
Để biểu đồ trông đẹp mắt và "clean" hơn, chúng ta có thể thay đổi background (dùng ``theme_bw()``, ``theme_classic()``, ``theme_dark()``...) và loại bỏ những chi tiết nhỏ không cần thiết trong biểu đồ tùy vào từng trường hợp như: gridlines, tiêu đề và giá trị trên trục X,Y, tiêu đề và giá trị của legend... bằng việc thêm option ``+`` ``theme()``
Trong trường hợp này, chúng ta dùng background đen trắng ``theme_bw()`` để biểu đồ trông "clean" và dễ nhìn hơn. Ngoài ra, chúng ta có thể loại bỏ những chi tiết thừa trên biểu đồ như: gridlines, ticks, giá trị và tên trục X do chúng ta đã có phần legend mô tả điều đó.
```{r}
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot() +
labs(title = "Overview of Iris Petal Length by Species",
x = "",        # Bỏ tên trục X
y = "Petal Length (cm)") +
scale_y_continuous(breaks = seq(0, 10, by = 0.5)) +
geom_point(aes(x = Species, y = round(mean_sepal_length, 1)),
data = mean_sepal_length_by_species, col = "red") +
geom_text(aes(
label = round(mean_sepal_length, 1),
x = Species,
y = round(mean_sepal_length)
),
data = mean_sepal_length_by_species,
check_overlap = TRUE,
vjust = -0.3
) +
theme_bw() +  # Background đen trắng
theme(
# Bỏ gridlines trục X
panel.grid.major.x = element_blank(),
# Bỏ tên giá trị trục X
axis.text.x = element_blank(),
# Bỏ ticks trục X
axis.ticks.x = element_blank()
)
```
Hoặc một cách khác, chúng ta có thể bỏ phần legend đi vì trên trục X đã mô tả những thông tin đó (``+`` ``theme(legend.position = "none")``).
```{r}
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot() +
labs(title = "Overview of Iris Petal Length by Species",
x = "Species",
y = "Petal Length (cm)") +
scale_y_continuous(breaks = seq(0,10, by = 0.5)) +
geom_point(aes(x = Species,
y = round(mean_sepal_length,1)),
data = mean_sepal_length_by_species, col = "red") +
geom_text(aes(label = round(mean_sepal_length,1),
x = Species, y = round(mean_sepal_length)),
data = mean_sepal_length_by_species, check_overlap = TRUE, vjust = -0.3) +
theme_bw() +  # Background đen trắng
theme(legend.position = "none")  # Bỏ legend
```
---
Như vậy, chúng ta đã vừa nắm đưcọ một số cách cơ bản để trình bày boxplot hiệu quả với `ggplot2`. Chúc các bạn học tập và làm việc hiệu quả với ``Ranalytics.vn``!
iris %>%
ggplot(aes(Species, Sepal.Length, fill = Species)) +
geom_boxplot() +
labs(
#  title = "Overview of Iris Petal Length by Species",
x = "Species",
y = "Petal Length (cm)") +
scale_y_continuous(breaks = seq(0,10, by = 0.5)) +
geom_point(aes(x = Species,
y = round(mean_sepal_length,1)),
data = mean_sepal_length_by_species, col = "red") +
geom_text(aes(label = round(mean_sepal_length,1),
x = Species, y = round(mean_sepal_length)),
data = mean_sepal_length_by_species, check_overlap = TRUE, vjust = -0.3) +
theme_bw() +  # Background đen trắng
theme(legend.position = "none")  # Bỏ legend
blogdown:::serve_site()
servr::daemon_stop("2543775232152")
