---
title: "Hướng dẫn sử dụng case_when trong dplyr"
author: "Nguyễn Hải Trường"
date: "2018-12-10"
categories:
  - data-manipulation
tags:
  - dplyr
summary: "Cách sử dụng hàm case_when trong dplyr"
banner: "img/banners/banner-24.png"
---
  
Thông thường trong quá trình phân tích dữ liệu, chúng ta sẽ gặp phải vấn đề liên quan đến chất lượng dữ liệu. Do vậy, việc trước tiên chúng ta cần phải làm đó là xử lý, làm sạch dữ liệu. Trong bài viết này, `Ranalytics` sẽ hướng dẫn các bạn sử dụng một trong những hàm rất phổ biến và hữu dụng trong việc xử lý dữ liệu trong `R` - hàm `case_when()`.

Chúng ta sẽ sử dụng dữ liệu `iris` có sẵn trong `R` để làm ví dụ minh họa.

```{r, warning=F, message=F}
library(dplyr)
data("iris")
iris %>% summary
```

Giả sử chúng ta muốn tạo thêm 1 biến mới (ví dụ tên là `Range_Sepal_Length`) dựa vào biến có sẵn `Sepal.Length` với những điều kiện như sau:

- Sepal.Length < 5 (cm): low

- 5 <= Sepal.Length <= 6 (cm): medium

- Sepal.Length > 6 (cm): high 

Như vậy, biến mới `Range_Sepal_Length` sẽ phải gồm 3 giá trị (`low`, `medium`, `high`) với những điều kiện nêu trên theo biến `Sepal.Length`.

Trong `R`, chúng ta sẽ sử dụng hàm `case_when()` kết hợp hàm `mutate()` (hàm `mutate()` chúng ta sử dụng khi muốn thêm trường dữ liệu mới trong `R`):

```{r, warning=F, message=F}
iris %>% 
  mutate(Range_Sepal_Length = case_when(
    Sepal.Length < 5 ~ "low",
    Sepal.Length >= 5 & Sepal.Length <= 6 ~ "medium",
    TRUE ~ "high"   # TRUE - với những trường hợp còn lại
  ) %>% as.factor) %>% 
  head
```


Như vậy, chúng ta đã vừa thêm trường dữ liệu mới `Range_Sepal_Length` - phái sinh từ trường `Sepal.Length`.

**Lưu ý!!!**: Đối với những ai đang sử dụng package `dplyr` version cũ, có thể sẽ gặp lỗi trong câu lệnh nói trên. Để khắc phục vấn đề trên, chúng ta có thể download package `dplyr` version mới nhất **HOẶC** đơn giản hơn là thêm `.$` vào trước biến để lọc điều kiện (trong trường hợp này là `Sepal.Length`) như sau:

```{r, warning=F, message=F}
iris %>% 
  mutate(Range_Sepal_Length = case_when(
    .$Sepal.Length < 5 ~ "low",
    .$Sepal.Length >= 5 & .$Sepal.Length <= 6 ~ "medium",
    TRUE ~ "high"   # TRUE - với những trường hợp còn lại
  ) %>% as.factor) %>% 
  head
```


Như vậy, chúng ta đã vừa được làm quen với cách sử dụng hàm `case_when()` kết hợp `mutate()`. Chúc các bạn học tập và làm việc hiệu quả với ``Ranalytics.vn``!