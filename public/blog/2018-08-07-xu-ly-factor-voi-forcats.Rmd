---
title: Xử lý factor với `forcats`
author: Nguyễn Hải Trường
date: '2018-08-07'
slug: xu-ly-factor-voi-forcats
categories:
  - Vizualization
tags:
  - forcats
  - factor
summary: "Cách xử lý dữ liệu factor cơ bản với `forcats`"
banner: "img/banners/banner-12.png"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = F, message = F)
```

Trong quá trình phân tích dữ liệu, chúng ta sẽ thường gặp phải những vấn đề liên quan đến việc xử lý các biến rời rạc (factor/categorical variable). Trong bài viết này, ``Ranalytics`` sẽ hướng dẫn các bạn sử dụng một số hàm cơ bản trong package ``forcats`` để xử lý các biến rời rạc.

---

# Forcats package

Package ``forcats`` là 1 package rất hữu dụng trong việc xử lý các biến rời rạc có thuộc tính là nhóm (factor) trong `R`.

Biến rời rạc là biến mà chúng ta không thể hiện được dưới dạng số, mà chỉ thể hiện tính chất của thực thế, ví dụ: giới tính, tình trạng hôn nhân, nghề nghiệp...


```{r}
library(dplyr)
library(ggplot2)
library(forcats)
```

# Factor Recode

Một trong những hàm rất hữu dụng trong package ``forcats`` là ``fct_recode``. Nó giúp chúng ta thay đổi các giá trị (levels) của 1 biến rời rạc (factor).


```{r, collapse = F}
# Sử dụng dữ liệu airquality có sẵn trong R
data("airquality")
airquality %>% str
airquality %>% summary
```

Trong tập dữ liệu trên, biến month đang có định dạng là integer, chuyển thành định dạng factor

```{r}
airquality$Month <- airquality$Month %>% 
  as.factor

airquality$Month %>% class
levels(airquality$Month)
```

Thay tên các tháng sử dụng hàm fct_recode

```{r}
airquality$Month <- fct_recode(airquality$Month, 
                               May = '5', 
                               June = '6', 
                               July = '7', 
                               August = '8', 
                               September = '9')

levels(airquality$Month)
```



```{r}
library(ggplot2)
airquality %>% 
  ggplot(aes(Month, Temp)) +
  geom_boxplot(aes(fill = Month)) +
  ggtitle(label = "Daily Temperatures Aggregated by Month") +
  theme_bw()
```

---

# Factor Reverse

Để đảo ngược lại thứ tự các giá trị trong 1 biến rời rạc chúng ta dùng hàm ``fct_rev``.

```{r}
airquality %>% 
  ggplot(aes(fct_rev(Month), Temp)) +
  geom_boxplot(aes(fill = Month)) +
  labs(x = "Month") +
  ggtitle(label = "Our plot now has the x-axis in reverse order") +
  theme_bw()
```

---

# Factor Relevel

Một hàm rất hữu dụng khác là ``fct_relevel``. Hàm này giúp chúng ta thay đổi bất kỳ giá trị của 1 biến rời rạc ở bất cứ vị trí nào ta mong muốn. Giả sử ta muốn vẽ biểu đồ nhiệt độ các tháng theo thứ tự: `September, July, May, August, June`

```{r}
airquality$Month <- fct_relevel(airquality$Month, 'September', 'July', 'May', 'August', 'June')
#Kiểm tra lại thứ tự của factor
levels(airquality$Month)
```


```{r}
airquality %>% 
  ggplot(aes(Month, Temp)) +
  geom_boxplot(aes(fill = Month)) +
  ggtitle(label = "Notice how the order of the level 'Month' has changed") +
  theme_bw()
```

---

# Factor Reorder

Một hàm khác thường xuyên được sử dụng để sắp xếp theo thứ tự tăng/giảm dần của 1 biến rời rạc dựa vào giá trị của 1 biến số khác là ``fct_reorder``.

Giả sử, trong trường hợp này chúng ta muốn sắp xếp các tháng theo nhiệt độ tăng dần. Ta có thể lựa chọn `.desc=T` (thứ tự giảm dần) hoặc `.desc=F` (tăng dần)

```{r}
airquality %>% 
  ggplot(aes(x = fct_reorder(Month, Temp, .desc = F), y = Temp)) +
  geom_boxplot(aes(fill = Month)) +
  labs(title = "We can make better comparison",
       subtitle = "by reordering the levels based on the temperature values!",
       x = "Month") +
  theme_bw() +
  theme(plot.title = element_text(size = 12, 
                                  face = 'bold'))
```

---

Như vậy, chúng ta đã vừa được làm quen với một số hàm cơ bản trong package ``forcats`` như thay đổi và sắp xếp thứ tự các giá trị của 1 biến rời rạc. Chúc các bạn học tập và làm việc hiệu quả với ``Ranalytics.vn``!

