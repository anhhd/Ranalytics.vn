<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Phân tích dữ liệu thực tế với R</title>
  <meta name="description" content="A book example for a Chapman &amp; Hall book.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Phân tích dữ liệu thực tế với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Phân tích dữ liệu thực tế với R" />
  
  <meta name="twitter:description" content="A book example for a Chapman &amp; Hall book." />
  

<meta name="author" content="Hoàng Đức Anh">


<meta name="date" content="2018-09-24">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="phan-ra-va-xoay-chiu-d-liu.html">
<link rel="next" href="khai-quat-v-hoc-may.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Phân tích dữ liệu thực tế với R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Lời mở đầu</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#tai-sao-nen-oc-cun-sach-nay"><i class="fa fa-check"></i>Tại sao nên đọc cuốn sách này</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#cu-truc-cua-sach"><i class="fa fa-check"></i>Cấu trúc của sách</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#cac-phn-mm-uc-s-dung"><i class="fa fa-check"></i>Các phần mềm được sử dụng</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#li-cam-on"><i class="fa fa-check"></i>Lời cảm ơn</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="v-tac-gia.html"><a href="v-tac-gia.html"><i class="fa fa-check"></i>Về tác giả</a></li>
<li class="part"><span><b>I Các kiến thức cơ bản</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Khoa học dữ liệu và nghề phân tích dữ liệu</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#khoa-hoc-d-liu"><i class="fa fa-check"></i><b>1.1</b> Khoa học dữ liệu</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#tai-sao-phan-tich-d-liu-la-ngh-kho"><i class="fa fa-check"></i><b>1.2</b> Tại sao phân tích dữ liệu là nghề khó?</a></li>
</ul></li>
<li class="part"><span><b>II Ứng dụng thực tế</b></span></li>
<li class="chapter" data-level="2" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><i class="fa fa-check"></i><b>2</b> Các phương pháp phân tích dữ liệu thực tế ứng dụng với R</a><ul>
<li class="chapter" data-level="2.1" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html#phn-1"><i class="fa fa-check"></i><b>2.1</b> Phần 1</a></li>
<li class="chapter" data-level="2.2" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html#phn-2"><i class="fa fa-check"></i><b>2.2</b> Phần 2</a></li>
<li class="chapter" data-level="2.3" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html#phn-3"><i class="fa fa-check"></i><b>2.3</b> Phần 3</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><i class="fa fa-check"></i><b>3</b> Ngữ pháp của biến đổi dữ liệu với DPLYR</a><ul>
<li class="chapter" data-level="3.1" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#gii-thiu-v-pipe-operator"><i class="fa fa-check"></i><b>3.1</b> Giới thiệu về pipe operator</a></li>
<li class="chapter" data-level="3.2" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#cac-ham-co-ban-trong-dplyr"><i class="fa fa-check"></i><b>3.2</b> Các hàm cơ bản trong dplyr</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#nhom-cau-lnh-truy-vn-d-liu"><i class="fa fa-check"></i><b>3.2.1</b> Nhóm câu lệnh truy vấn dữ liệu</a></li>
<li class="chapter" data-level="3.2.2" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#nhom-cau-lnh-bin-i-d-liu"><i class="fa fa-check"></i><b>3.2.2</b> Nhóm câu lệnh biến đổi dữ liệu</a></li>
<li class="chapter" data-level="3.2.3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#nhom-ham-tng-hp-d-liu-vi-summarise"><i class="fa fa-check"></i><b>3.2.3</b> Nhóm hàm tổng hợp dữ liệu với <code>summarise</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#cac-ham-nang-cao-trong-dplyr"><i class="fa fa-check"></i><b>3.3</b> Các hàm nâng cao trong dplyr</a><ul>
<li class="chapter" data-level="3.3.1" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#iu-kin-phan-nhom-vi-case_when"><i class="fa fa-check"></i><b>3.3.1</b> Điều kiện phân nhóm với <code>case_when</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#tao-them-bin-mi-theo-iu-kin-vi-mutate_if-mutate_at"><i class="fa fa-check"></i><b>3.3.2</b> Tạo thêm biến mới theo điều kiện với <code>mutate_if</code> &amp; <code>mutate_at</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#tng-hp-d-liu-theo-iu-kin-vi-summarise_at-va-summarise_if"><i class="fa fa-check"></i><b>3.3.3</b> Tổng hợp dữ liệu theo điều kiện với <code>summarise_at</code> và <code>summarise_if</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html"><i class="fa fa-check"></i><b>4</b> Phân rã và xoay chiều dữ liệu</a><ul>
<li class="chapter" data-level="4.1" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#phan-ra-d-liu-thanh-dang-doc-vi-gather"><i class="fa fa-check"></i><b>4.1</b> Phân rã dữ liệu thành dạng dọc với <code>gather</code></a></li>
<li class="chapter" data-level="4.2" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#xoay-chiu-d-liu-vi-spread"><i class="fa fa-check"></i><b>4.2</b> Xoay chiều dữ liệu với <code>spread</code></a></li>
<li class="chapter" data-level="4.3" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#tach-mt-bin-thanh-nhiu-bin-vi-separate"><i class="fa fa-check"></i><b>4.3</b> Tách một biến thành nhiều biến với <code>separate</code></a></li>
<li class="chapter" data-level="4.4" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#gp-nhiu-bin-thanh-mt-bin-vi-unite"><i class="fa fa-check"></i><b>4.4</b> Gộp nhiều biến thành một biến với <code>unite</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html"><i class="fa fa-check"></i><b>5</b> Lập trình chức năng hàm với purrr</a><ul>
<li class="chapter" data-level="5.1" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#nhom-ham-map"><i class="fa fa-check"></i><b>5.1</b> Nhóm hàm map</a></li>
<li class="chapter" data-level="5.2" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#sa-i-gia-tri-vi-modify"><i class="fa fa-check"></i><b>5.2</b> Sửa đổi giá trị với <code>modify</code></a></li>
<li class="chapter" data-level="5.3" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#ng-dung"><i class="fa fa-check"></i><b>5.3</b> Ứng dụng</a><ul>
<li class="chapter" data-level="5.3.1" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#bin-i-d-liu-vi-modify-va-map_df"><i class="fa fa-check"></i><b>5.3.1</b> Biến đổi dữ liệu với <code>modify</code> và <code>map_df</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#phan-tich-nhiu-nhom-khac-nhau-cung-luc"><i class="fa fa-check"></i><b>5.3.2</b> Phân tích nhiều nhóm khác nhau cùng lúc</a></li>
<li class="chapter" data-level="5.3.3" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#phan-tich-nhiu-bin-trong-dataframe-cung-luc"><i class="fa fa-check"></i><b>5.3.3</b> Phân tích nhiều biến trong dataframe cùng lúc</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Machine Learning</b></span></li>
<li class="chapter" data-level="6" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html"><i class="fa fa-check"></i><b>6</b> Khái quát về học máy</a><ul>
<li class="chapter" data-level="6.1" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#gii-thiu"><i class="fa fa-check"></i><b>6.1</b> Giới thiệu</a></li>
<li class="chapter" data-level="6.2" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#quy-trinh-xay-dng-mo-hinh-d-bao"><i class="fa fa-check"></i><b>6.2</b> Quy trình xây dựng mô hình dự báo</a></li>
<li class="chapter" data-level="6.3" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#cac-nhom-thut-ng-cn-nh"><i class="fa fa-check"></i><b>6.3</b> Các nhóm thuật ngữ cần nhớ</a></li>
<li class="chapter" data-level="6.4" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#luu-y"><i class="fa fa-check"></i><b>6.4</b> Lưu ý</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html"><i class="fa fa-check"></i><b>7</b> Phân tích giỏ hàng</a><ul>
<li class="chapter" data-level="7.1" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#cac-khai-nim-co-ban"><i class="fa fa-check"></i><b>7.1</b> Các khái niệm cơ bản</a></li>
<li class="chapter" data-level="7.2" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#cach-thc-hin-mo-hinh"><i class="fa fa-check"></i><b>7.2</b> Cách thực hiện mô hình</a></li>
<li class="chapter" data-level="7.3" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#ba-cau-hoi-khi-phan-tich-gio-hang"><i class="fa fa-check"></i><b>7.3</b> Ba câu hỏi khi phân tích giỏ hàng</a><ul>
<li class="chapter" data-level="7.3.1" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#cac-san-phm-nao-hay-uc-mua-cung-nhau"><i class="fa fa-check"></i><b>7.3.1</b> Các sản phẩm nào hay được mua cùng nhau</a></li>
<li class="chapter" data-level="7.3.2" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#khach-hang-mua-san-phm-a-thi-se-mua-san-phm-nao-tip-theo"><i class="fa fa-check"></i><b>7.3.2</b> Khách hàng mua sản phẩm A thì sẽ mua sản phẩm nào tiếp theo?</a></li>
<li class="chapter" data-level="7.3.3" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#khach-hang-mua-san-phm-gi-thi-se-mua-tip-san-phm-a"><i class="fa fa-check"></i><b>7.3.3</b> Khách hàng mua sản phẩm gì thì sẽ mua tiếp sản phẩm A?</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#uu-nhuc-im"><i class="fa fa-check"></i><b>7.4</b> Ưu nhược điểm</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="feature-engineering.html"><a href="feature-engineering.html"><i class="fa fa-check"></i><b>8</b> Feature Engineering</a><ul>
<li class="chapter" data-level="8.1" data-path="feature-engineering.html"><a href="feature-engineering.html#feature-engineering-cho-cac-bin-nhom"><i class="fa fa-check"></i><b>8.1</b> Feature engineering cho các biến nhóm</a><ul>
<li class="chapter" data-level="8.1.1" data-path="feature-engineering.html"><a href="feature-engineering.html#tao-d-liu-gia-dummy-data-cho-bin-khong-phan-bit-th-t"><i class="fa fa-check"></i><b>8.1.1</b> Tạo dữ liệu giả (dummy data) cho biến không phân biệt thứ tự</a></li>
<li class="chapter" data-level="8.1.2" data-path="feature-engineering.html"><a href="feature-engineering.html#d-liu-co-rt-nhiu-nhom"><i class="fa fa-check"></i><b>8.1.2</b> Dữ liệu có rất nhiều nhóm</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="feature-engineering.html"><a href="feature-engineering.html#cac-bin-lien-tuc"><i class="fa fa-check"></i><b>8.2</b> Các biến liên tục</a><ul>
<li class="chapter" data-level="8.2.1" data-path="feature-engineering.html"><a href="feature-engineering.html#bin-i-11"><i class="fa fa-check"></i><b>8.2.1</b> Biến đổi 1:1</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Chuỗi thời gian</b></span></li>
<li class="chapter" data-level="9" data-path="gii-thiu-v-chui-thi-gian.html"><a href="gii-thiu-v-chui-thi-gian.html"><i class="fa fa-check"></i><b>9</b> Giới thiệu về chuỗi thời gian</a><ul>
<li class="chapter" data-level="9.1" data-path="gii-thiu-v-chui-thi-gian.html"><a href="gii-thiu-v-chui-thi-gian.html#thanh-phn-cua-chui-thi-gian"><i class="fa fa-check"></i><b>9.1</b> Thành phần của chuỗi thời gian</a></li>
</ul></li>
<li class="part"><span><b>V Case study</b></span></li>
<li class="chapter" data-level="10" data-path="trc-quan-hoa-d-liu.html"><a href="trc-quan-hoa-d-liu.html"><i class="fa fa-check"></i><b>10</b> Trực quan hóa dữ liệu</a><ul>
<li class="chapter" data-level="10.1" data-path="trc-quan-hoa-d-liu.html"><a href="trc-quan-hoa-d-liu.html#xay-dng-phu-ban-hang-theo-tng-nhom"><i class="fa fa-check"></i><b>10.1</b> Xây dựng phễu bán hàng theo từng nhóm</a></li>
<li class="chapter" data-level="10.2" data-path="trc-quan-hoa-d-liu.html"><a href="trc-quan-hoa-d-liu.html#ve-biu--warterfall-cho-aciveinactive-users"><i class="fa fa-check"></i><b>10.2</b> Vẽ biểu đồ warterfall cho acive/inactive users</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="more-to-say.html"><a href="more-to-say.html"><i class="fa fa-check"></i><b>A</b> More to Say</a></li>
<li class="chapter" data-level="" data-path="tai-liu-tham-khao.html"><a href="tai-liu-tham-khao.html"><i class="fa fa-check"></i>Tài liệu tham khảo</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Phân tích dữ liệu thực tế với R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lp-trinh-chc-nang-ham-vi-purrr" class="section level1">
<h1><span class="header-section-number">Chương 5</span> Lập trình chức năng hàm với purrr</h1>
<p>Khi phân tích dữ liệu phức tạp, ta thường xuyên phải thực hiện một nhóm các phân tích tương tự nhau cho các nhóm dữ liệu khác nhau. Việc sử dụng các hàm làm đơn vị thao tác cơ bản và phối hợp các hàm với nhau được gọi là lập trình chức năng hàm (functional programming). Để đơn giản, ta xét ví dụ sau.</p>
<p>Sử dụng tập dữ liệu <code>iris</code>, với mỗi nhóm của <code>Species</code>, xây dựng mô hình hồi quy giữa <code>Sepal.Length</code> và <code>Petal.Length</code>, so sánh giá trị <code>r.squared</code> giữa các mô hình.</p>
<p>Với cách làm thông thường, ta sẽ phải thức hiện theo thứ tự sau:</p>
<ul>
<li>Tạo các data.frame cho từng giá trị của Species</li>
<li>Với mỗi data.frame vừa tạo, xây dựng mô hình <code>lm</code></li>
<li>Với mỗi mô hình vừa tạo, chiết xuất giá trị <code>r.squared</code> và lưu vào một data.frame</li>
</ul>
<p>Cách triển khai trên có thể sử dụng vòng lặp trong R với phương án như sau</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"></a>
<a class="sourceLine" id="cb123-3" data-line-number="3">category &lt;-<span class="st"> </span>iris<span class="op">$</span>Species <span class="op">%&gt;%</span><span class="st"> </span>levels <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">model_result &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb123-5" data-line-number="5"><span class="cf">for</span> (i <span class="cf">in</span> category){</a>
<a class="sourceLine" id="cb123-6" data-line-number="6">  df &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Species <span class="op">==</span><span class="st"> </span>i)</a>
<a class="sourceLine" id="cb123-7" data-line-number="7">  model &lt;-<span class="st"> </span><span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Sepal.Width, <span class="dt">data =</span> df)</a>
<a class="sourceLine" id="cb123-8" data-line-number="8">  model_summary &lt;-<span class="st"> </span><span class="kw">summary</span>(model)</a>
<a class="sourceLine" id="cb123-9" data-line-number="9">  df_temp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">species =</span> i,</a>
<a class="sourceLine" id="cb123-10" data-line-number="10">                        <span class="dt">r.square =</span> model_summary<span class="op">$</span>r.squared)</a>
<a class="sourceLine" id="cb123-11" data-line-number="11">  model_result &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(model_result, df_temp)</a>
<a class="sourceLine" id="cb123-12" data-line-number="12">}</a></code></pre></div>
<p>Tuy nhiên, với lập trình chức năng hàm, ta có thể làm rất đơn giản như sau.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb124-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-3" data-line-number="3"><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>Species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-4" data-line-number="4"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Sepal.Width, <span class="dt">data =</span> .)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-5" data-line-number="5"><span class="st">  </span><span class="kw">map</span>(summary) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-6" data-line-number="6"><span class="st">  </span><span class="kw">map_dbl</span>(<span class="st">&quot;r.squared&quot;</span>)</a></code></pre></div>
<pre><code>##     setosa versicolor  virginica 
##     0.5514     0.2766     0.2091</code></pre>
<p>Trong chương này, chúng ta sẽ tìm hiểu các cách thức cơ bản lập trình chức năng hàm với R qua package <code>purrr</code>. Việc nắm vững kiến thức và kỹ năng lập trình hàm có rất nhiều ứng dụng trong công việc phân tích, giúp giảm thiểu rất lớn thời gian phân tích, làm cho quá trình phân tích mạch lạc hơn rất nhiều trong các bài toán khám phá dữ liệu</p>
<div id="nhom-ham-map" class="section level2">
<h2><span class="header-section-number">5.1</span> Nhóm hàm map</h2>
<p>Công thức tổng quát của nhóm hàm map</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw">map</span>(.x, .f, ...)</a></code></pre></div>
<p><strong>Giải thích</strong>: Với mỗi giá trị của <code>.x</code>, thực hiện <code>.f</code>. Trong đó, x là một list.</p>
<p>Hàm map làm hàm tổng quát, ngoài ra, <code>map</code> còn có các biến thể chính sau</p>
<table>
<thead>
<tr class="header">
<th>Câu lênh</th>
<th>Kết quả</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>map</td>
<td>list</td>
</tr>
<tr class="even">
<td>map_dbl</td>
<td>vector dạng double</td>
</tr>
<tr class="odd">
<td>map_int</td>
<td>vector dạng int</td>
</tr>
<tr class="even">
<td>map_chr</td>
<td>vector dạng character</td>
</tr>
<tr class="odd">
<td>map_df</td>
<td>data.frame</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="co"># Dạng list</span></a>
<a class="sourceLine" id="cb127-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(class)</a></code></pre></div>
<pre><code>## $Sepal.Length
## [1] &quot;numeric&quot;
## 
## $Sepal.Width
## [1] &quot;numeric&quot;
## 
## $Petal.Length
## [1] &quot;numeric&quot;
## 
## $Petal.Width
## [1] &quot;numeric&quot;
## 
## $Species
## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="co"># Dạng char</span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(class)</a></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
##    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot; 
##      Species 
##     &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="co"># Dạng data.frame</span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_df</span>(class)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
##   &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;      
## 1 numeric      numeric     numeric      numeric    
## # ... with 1 more variable: Species &lt;chr&gt;</code></pre>
<p><strong>Map theo điều kiện với <code>map_if</code> và <code>map_at</code></strong></p>
<p>Tương tự với <code>map</code>, nhóm <code>map_if</code> và <code>map_at</code> cho phép tính toán theo điều kiện hoặc vị trí của list. Xem ví dụ sau.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="co"># map_if</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-3" data-line-number="3"><span class="st">  </span><span class="kw">map_if</span>(is.numeric, as.character) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-4" data-line-number="4"><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-5" data-line-number="5"><span class="st">  </span>str</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: Factor w/ 35 levels &quot;4.3&quot;,&quot;4.4&quot;,&quot;4.5&quot;,..: 9 7 5 4 8 12 4 8 2 7 ...
##  $ Sepal.Width : Factor w/ 23 levels &quot;2&quot;,&quot;2.2&quot;,&quot;2.3&quot;,..: 15 10 12 11 16 19 14 14 9 11 ...
##  $ Petal.Length: Factor w/ 43 levels &quot;1&quot;,&quot;1.1&quot;,&quot;1.2&quot;,..: 5 5 4 6 5 8 5 6 5 6 ...
##  $ Petal.Width : Factor w/ 22 levels &quot;0.1&quot;,&quot;0.2&quot;,&quot;0.3&quot;,..: 2 2 2 2 2 4 3 2 2 1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="co"># map_at</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw">map_at</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), as.character) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-4" data-line-number="4"><span class="st">  </span>str</a></code></pre></div>
<pre><code>## List of 5
##  $ Sepal.Length: chr [1:150] &quot;5.1&quot; &quot;4.9&quot; &quot;4.7&quot; &quot;4.6&quot; ...
##  $ Sepal.Width : chr [1:150] &quot;3.5&quot; &quot;3&quot; &quot;3.2&quot; &quot;3.1&quot; ...
##  $ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num [1:150] 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div id="sa-i-gia-tri-vi-modify" class="section level2">
<h2><span class="header-section-number">5.2</span> Sửa đổi giá trị với <code>modify</code></h2>
<p>Tương tự như <code>map</code>, <code>modify</code> cho áp dụng hàm vào một nhóm các list. Tuy nhiên, khác với <code>map</code>, <code>modify</code> cho ra kết quả với cấu trúc dữ liệu ban đâu.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="co"># map đổi cấu trúc của dataframe</span></a>
<a class="sourceLine" id="cb137-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb137-3" data-line-number="3"><span class="st">  </span><span class="kw">map_if</span>(is.factor, as.character) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb137-4" data-line-number="4"><span class="st">  </span>str</a></code></pre></div>
<pre><code>## List of 5
##  $ Sepal.Length: num [1:150] 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num [1:150] 3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num [1:150] 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : chr [1:150] &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; ...</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="co"># modify giữ nguyên cấu trúc</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-3" data-line-number="3"><span class="st">  </span><span class="kw">modify_if</span>(is.factor, as.character) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-4" data-line-number="4"><span class="st">  </span>str</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : chr  &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; ...</code></pre>
</div>
<div id="ng-dung" class="section level2">
<h2><span class="header-section-number">5.3</span> Ứng dụng</h2>
<div id="bin-i-d-liu-vi-modify-va-map_df" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Biến đổi dữ liệu với <code>modify</code> và <code>map_df</code></h3>
<p>Khi phân tích dữ liệu, đôi khi ta cần chuẩn hóa dữ liệu cho tất cả các biến numeric trong data.frame. Với nhóm hàm của purrr, ta có thể thực hiện như sau</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="co"># Tạo hàm</span></a>
<a class="sourceLine" id="cb141-2" data-line-number="2">standardize_data &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb141-3" data-line-number="3">  x &lt;-<span class="st"> </span>(x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))<span class="op">/</span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))</a>
<a class="sourceLine" id="cb141-4" data-line-number="4">  <span class="kw">return</span>(x)</a>
<a class="sourceLine" id="cb141-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb141-6" data-line-number="6"><span class="co"># Sử dụng map_df</span></a>
<a class="sourceLine" id="cb141-7" data-line-number="7">df &lt;-<span class="st"> </span>iris</a>
<a class="sourceLine" id="cb141-8" data-line-number="8">df[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>] &lt;-<span class="st"> </span>df[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_df</span>(standardize_data)</a>
<a class="sourceLine" id="cb141-9" data-line-number="9">df <span class="op">%&gt;%</span><span class="st"> </span>head</a></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1      0.22222      0.6250      0.06780     0.04167
## 2      0.16667      0.4167      0.06780     0.04167
## 3      0.11111      0.5000      0.05085     0.04167
## 4      0.08333      0.4583      0.08475     0.04167
## 5      0.19444      0.6667      0.06780     0.04167
## 6      0.30556      0.7917      0.11864     0.12500
##   Species
## 1  setosa
## 2  setosa
## 3  setosa
## 4  setosa
## 5  setosa
## 6  setosa</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="co"># Sử dụng modify</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"><span class="co"># Sử dụng map_df</span></a>
<a class="sourceLine" id="cb143-3" data-line-number="3">df &lt;-<span class="st"> </span>iris</a>
<a class="sourceLine" id="cb143-4" data-line-number="4">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">modify_if</span>(is.numeric, standardize_data)</a>
<a class="sourceLine" id="cb143-5" data-line-number="5">df <span class="op">%&gt;%</span><span class="st"> </span>head</a></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1      0.22222      0.6250      0.06780     0.04167
## 2      0.16667      0.4167      0.06780     0.04167
## 3      0.11111      0.5000      0.05085     0.04167
## 4      0.08333      0.4583      0.08475     0.04167
## 5      0.19444      0.6667      0.06780     0.04167
## 6      0.30556      0.7917      0.11864     0.12500
##   Species
## 1  setosa
## 2  setosa
## 3  setosa
## 4  setosa
## 5  setosa
## 6  setosa</code></pre>
</div>
<div id="phan-tich-nhiu-nhom-khac-nhau-cung-luc" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Phân tích nhiều nhóm khác nhau cùng lúc</h3>
<p>Khi phân tích dữ liệu, đôi khi ta muốn xây dựng chuẩn phân tích dữ liệu qua một số bước, bao gồm:</p>
<ul>
<li>Tính toán các chỉ số thống kê</li>
<li>Vẽ đồ thị</li>
<li>Xây dụng mô hình đơn giản</li>
</ul>
<p>Quy trình này sẽ không gặp vấn đề khi ta chỉ phải xử lý với một nhóm nhỏ dữ liệu. Khi số lượng nhóm tăng lên, việc phân tích dữ liệu trở nên khó khăn hơn rất nhiều và tốn thời gian. Tuy nhiên, với <code>purrr</code>, các vấn đề này trở nên rất đơn giản.</p>
<p><strong>Ví dụ</strong>: Với mỗi nhóm của Species trong tập dữ liệu iris:</p>
<ul>
<li>Tổng hơp dữ liệu</li>
<li>Vẽ đồ thị điểm giữa Sepal.Length vs. Petal.Length</li>
<li>Xây dựng mô hình hồi quy Sepal.Length ~ Petal.Length</li>
</ul>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="co"># Bước một: Xây dựng hàm</span></a>
<a class="sourceLine" id="cb145-3" data-line-number="3">my_stat &lt;-<span class="st"> </span><span class="cf">function</span>(data){</a>
<a class="sourceLine" id="cb145-4" data-line-number="4">  <span class="kw">print</span>(<span class="st">&quot;Summary data&quot;</span>)</a>
<a class="sourceLine" id="cb145-5" data-line-number="5">  <span class="kw">print</span>(<span class="st">&quot;====================&quot;</span>)</a>
<a class="sourceLine" id="cb145-6" data-line-number="6">  <span class="kw">summary</span>(data) <span class="op">%&gt;%</span><span class="st"> </span>print</a>
<a class="sourceLine" id="cb145-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb145-8" data-line-number="8">  p &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb145-9" data-line-number="9"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Sepal.Length, Petal.Length)) <span class="op">+</span></a>
<a class="sourceLine" id="cb145-10" data-line-number="10"><span class="st">    </span><span class="kw">geom_point</span>() </a>
<a class="sourceLine" id="cb145-11" data-line-number="11"></a>
<a class="sourceLine" id="cb145-12" data-line-number="12">  <span class="kw">print</span>(<span class="st">&quot;Summary model&quot;</span>)</a>
<a class="sourceLine" id="cb145-13" data-line-number="13">  <span class="kw">print</span>(<span class="st">&quot;====================&quot;</span>)</a>
<a class="sourceLine" id="cb145-14" data-line-number="14">  model &lt;-<span class="st"> </span><span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Petal.Length, <span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb145-15" data-line-number="15">  <span class="kw">summary</span>(model) <span class="op">%&gt;%</span><span class="st"> </span>print</a>
<a class="sourceLine" id="cb145-16" data-line-number="16">  p <span class="op">%&gt;%</span><span class="st"> </span>print</a>
<a class="sourceLine" id="cb145-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb145-18" data-line-number="18"><span class="co"># Test hàm</span></a>
<a class="sourceLine" id="cb145-19" data-line-number="19"><span class="kw">my_stat</span>(iris)</a></code></pre></div>
<pre><code>## [1] &quot;Summary data&quot;
## [1] &quot;====================&quot;
##   Sepal.Length   Sepal.Width    Petal.Length 
##  Min.   :4.30   Min.   :2.00   Min.   :1.00  
##  1st Qu.:5.10   1st Qu.:2.80   1st Qu.:1.60  
##  Median :5.80   Median :3.00   Median :4.35  
##  Mean   :5.84   Mean   :3.06   Mean   :3.76  
##  3rd Qu.:6.40   3rd Qu.:3.30   3rd Qu.:5.10  
##  Max.   :7.90   Max.   :4.40   Max.   :6.90  
##   Petal.Width        Species  
##  Min.   :0.1   setosa    :50  
##  1st Qu.:0.3   versicolor:50  
##  Median :1.3   virginica :50  
##  Mean   :1.2                  
##  3rd Qu.:1.8                  
##  Max.   :2.5                  
## [1] &quot;Summary model&quot;
## [1] &quot;====================&quot;
## 
## Call:
## lm(formula = Sepal.Length ~ Petal.Length, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.2468 -0.2966 -0.0152  0.2768  1.0027 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    4.3066     0.0784    54.9   &lt;2e-16 ***
## Petal.Length   0.4089     0.0189    21.6   &lt;2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.407 on 148 degrees of freedom
## Multiple R-squared:  0.76,   Adjusted R-squared:  0.758 
## F-statistic:  469 on 1 and 148 DF,  p-value: &lt;2e-16</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="co"># Bước 2: Xây dựng map</span></a>
<a class="sourceLine" id="cb147-2" data-line-number="2"></a>
<a class="sourceLine" id="cb147-3" data-line-number="3">iris<span class="op">$</span>Species <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-4" data-line-number="4"><span class="st">  </span>unique <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-5" data-line-number="5"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(value){</a>
<a class="sourceLine" id="cb147-6" data-line-number="6">    <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Analysis of &quot;</span>, value))</a>
<a class="sourceLine" id="cb147-7" data-line-number="7">    iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-8" data-line-number="8"><span class="st">      </span><span class="kw">filter</span>(Species <span class="op">==</span><span class="st"> </span>value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-9" data-line-number="9"><span class="st">      </span>my_stat</a>
<a class="sourceLine" id="cb147-10" data-line-number="10">  })</a></code></pre></div>
<pre><code>## [1] &quot;Analysis of setosa&quot;
## [1] &quot;Summary data&quot;
## [1] &quot;====================&quot;
##   Sepal.Length   Sepal.Width    Petal.Length 
##  Min.   :4.30   Min.   :2.30   Min.   :1.00  
##  1st Qu.:4.80   1st Qu.:3.20   1st Qu.:1.40  
##  Median :5.00   Median :3.40   Median :1.50  
##  Mean   :5.01   Mean   :3.43   Mean   :1.46  
##  3rd Qu.:5.20   3rd Qu.:3.67   3rd Qu.:1.57  
##  Max.   :5.80   Max.   :4.40   Max.   :1.90  
##   Petal.Width          Species  
##  Min.   :0.100   setosa    :50  
##  1st Qu.:0.200   versicolor: 0  
##  Median :0.200   virginica : 0  
##  Mean   :0.246                  
##  3rd Qu.:0.300                  
##  Max.   :0.600                  
## [1] &quot;Summary model&quot;
## [1] &quot;====================&quot;
## 
## Call:
## lm(formula = Sepal.Length ~ Petal.Length, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.5724 -0.2067 -0.0308  0.1734  0.9361 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     4.213      0.416   10.14  1.6e-13 ***
## Petal.Length    0.542      0.282    1.92    0.061 .  
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.343 on 48 degrees of freedom
## Multiple R-squared:  0.0714, Adjusted R-squared:  0.052 
## F-statistic: 3.69 on 1 and 48 DF,  p-value: 0.0607</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-60-2.png" width="672" /></p>
<pre><code>## [1] &quot;Analysis of versicolor&quot;
## [1] &quot;Summary data&quot;
## [1] &quot;====================&quot;
##   Sepal.Length   Sepal.Width    Petal.Length 
##  Min.   :4.90   Min.   :2.00   Min.   :3.00  
##  1st Qu.:5.60   1st Qu.:2.52   1st Qu.:4.00  
##  Median :5.90   Median :2.80   Median :4.35  
##  Mean   :5.94   Mean   :2.77   Mean   :4.26  
##  3rd Qu.:6.30   3rd Qu.:3.00   3rd Qu.:4.60  
##  Max.   :7.00   Max.   :3.40   Max.   :5.10  
##   Petal.Width         Species  
##  Min.   :1.00   setosa    : 0  
##  1st Qu.:1.20   versicolor:50  
##  Median :1.30   virginica : 0  
##  Mean   :1.33                  
##  3rd Qu.:1.50                  
##  Max.   :1.80                  
## [1] &quot;Summary model&quot;
## [1] &quot;====================&quot;
## 
## Call:
## lm(formula = Sepal.Length ~ Petal.Length, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.7348 -0.2027 -0.0206  0.2609  0.6996 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     2.408      0.446    5.39  2.1e-06 ***
## Petal.Length    0.828      0.104    7.95  2.6e-10 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.343 on 48 degrees of freedom
## Multiple R-squared:  0.569,  Adjusted R-squared:  0.56 
## F-statistic: 63.3 on 1 and 48 DF,  p-value: 2.59e-10</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-60-3.png" width="672" /></p>
<pre><code>## [1] &quot;Analysis of virginica&quot;
## [1] &quot;Summary data&quot;
## [1] &quot;====================&quot;
##   Sepal.Length   Sepal.Width    Petal.Length 
##  Min.   :4.90   Min.   :2.20   Min.   :4.50  
##  1st Qu.:6.22   1st Qu.:2.80   1st Qu.:5.10  
##  Median :6.50   Median :3.00   Median :5.55  
##  Mean   :6.59   Mean   :2.97   Mean   :5.55  
##  3rd Qu.:6.90   3rd Qu.:3.17   3rd Qu.:5.88  
##  Max.   :7.90   Max.   :3.80   Max.   :6.90  
##   Petal.Width         Species  
##  Min.   :1.40   setosa    : 0  
##  1st Qu.:1.80   versicolor: 0  
##  Median :2.00   virginica :50  
##  Mean   :2.03                  
##  3rd Qu.:2.30                  
##  Max.   :2.50                  
## [1] &quot;Summary model&quot;
## [1] &quot;====================&quot;
## 
## Call:
## lm(formula = Sepal.Length ~ Petal.Length, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.7341 -0.2364 -0.0313  0.2377  0.7621 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    1.0597     0.4668    2.27    0.028 *  
## Petal.Length   0.9957     0.0837   11.90  6.3e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.323 on 48 degrees of freedom
## Multiple R-squared:  0.747,  Adjusted R-squared:  0.742 
## F-statistic:  142 on 1 and 48 DF,  p-value: 6.3e-16</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-60-4.png" width="672" /></p>
<pre><code>## [[1]]</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-60-5.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-60-6.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-60-7.png" width="672" /></p>
</div>
<div id="phan-tich-nhiu-bin-trong-dataframe-cung-luc" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Phân tích nhiều biến trong dataframe cùng lúc</h3>
<p>Một biên thể khác của <code>map</code> là sử dụng trong phân tích cùng lúc nhiều biến số với một biến thuộc dạng nhóm (group). Khi lập trình với NSE, ta cần phải sử dụng hàm <code>syms()</code> trước khi <code>map</code></p>
<p><strong>Ví dụ</strong>: Với mỗi biến số trong tập dữ liệu <code>iris</code>:</p>
<ul>
<li>So sánh giá trị trung bình của biến này với các nhóm khác nhau của <code>Species</code></li>
<li>Vẽ biểu đồ boxplot</li>
</ul>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb154-2" data-line-number="2"></a>
<a class="sourceLine" id="cb154-3" data-line-number="3"><span class="co"># Bước 1: Xây dựng hàm</span></a>
<a class="sourceLine" id="cb154-4" data-line-number="4"></a>
<a class="sourceLine" id="cb154-5" data-line-number="5">my_stat &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb154-6" data-line-number="6">  x &lt;-<span class="st"> </span><span class="kw">enquo</span>(x)</a>
<a class="sourceLine" id="cb154-7" data-line-number="7">  iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb154-8" data-line-number="8"><span class="st">    </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb154-9" data-line-number="9"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(<span class="op">!!</span>x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb154-10" data-line-number="10"><span class="st">    </span>print</a>
<a class="sourceLine" id="cb154-11" data-line-number="11">  iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb154-12" data-line-number="12"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Species, <span class="op">!!</span>x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-13" data-line-number="13"><span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> Species)) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-14" data-line-number="14"><span class="st">    </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb154-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb154-16" data-line-number="16"><span class="kw">my_stat</span>(Sepal.Length)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Species     mean
##   &lt;fct&gt;      &lt;dbl&gt;
## 1 setosa      5.01
## 2 versicolor  5.94
## 3 virginica   6.59</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="co"># Bước 2: Dùng map</span></a>
<a class="sourceLine" id="cb156-2" data-line-number="2">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="st">  </span><span class="kw">select_if</span>(is.numeric) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-4" data-line-number="4"><span class="st">  </span>names <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-5" data-line-number="5"><span class="st">  </span>syms <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-6" data-line-number="6"><span class="st">  </span><span class="kw">map</span>(my_stat)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Species     mean
##   &lt;fct&gt;      &lt;dbl&gt;
## 1 setosa      5.01
## 2 versicolor  5.94
## 3 virginica   6.59
## # A tibble: 3 x 2
##   Species     mean
##   &lt;fct&gt;      &lt;dbl&gt;
## 1 setosa      3.43
## 2 versicolor  2.77
## 3 virginica   2.97
## # A tibble: 3 x 2
##   Species     mean
##   &lt;fct&gt;      &lt;dbl&gt;
## 1 setosa      1.46
## 2 versicolor  4.26
## 3 virginica   5.55
## # A tibble: 3 x 2
##   Species     mean
##   &lt;fct&gt;      &lt;dbl&gt;
## 1 setosa     0.246
## 2 versicolor 1.33 
## 3 virginica  2.03</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-61-2.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-61-3.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-61-4.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-61-5.png" width="672" /></p>
<p><strong>Lưu ý</strong>: Việc ứng dụng <code>purrr</code> với các hàm tính toán thống kê sẽ cho phép phân tích khám phá dữ liệu hàng loạt</p>


</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="phan-ra-va-xoay-chiu-d-liu.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="khai-quat-v-hoc-may.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/07-lap-trinh-ham-voi-purrr.Rmd",
"text": "Edit"
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
