<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Phân tích dữ liệu thực tế với R</title>
  <meta name="description" content="A book example for a Chapman &amp; Hall book.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Phân tích dữ liệu thực tế với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Phân tích dữ liệu thực tế với R" />
  
  <meta name="twitter:description" content="A book example for a Chapman &amp; Hall book." />
  

<meta name="author" content="Hoàng Đức Anh">


<meta name="date" content="2018-09-24">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="gii-thiu-v-chui-thi-gian.html">
<link rel="next" href="more-to-say.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Phân tích dữ liệu thực tế với R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Lời mở đầu</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#tai-sao-nen-oc-cun-sach-nay"><i class="fa fa-check"></i>Tại sao nên đọc cuốn sách này</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#cu-truc-cua-sach"><i class="fa fa-check"></i>Cấu trúc của sách</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#cac-phn-mm-uc-s-dung"><i class="fa fa-check"></i>Các phần mềm được sử dụng</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#li-cam-on"><i class="fa fa-check"></i>Lời cảm ơn</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="v-tac-gia.html"><a href="v-tac-gia.html"><i class="fa fa-check"></i>Về tác giả</a></li>
<li class="part"><span><b>I Các kiến thức cơ bản</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Khoa học dữ liệu và nghề phân tích dữ liệu</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#khoa-hoc-d-liu"><i class="fa fa-check"></i><b>1.1</b> Khoa học dữ liệu</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#tai-sao-phan-tich-d-liu-la-ngh-kho"><i class="fa fa-check"></i><b>1.2</b> Tại sao phân tích dữ liệu là nghề khó?</a></li>
</ul></li>
<li class="part"><span><b>II Ứng dụng thực tế</b></span></li>
<li class="chapter" data-level="2" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><i class="fa fa-check"></i><b>2</b> Các phương pháp phân tích dữ liệu thực tế ứng dụng với R</a><ul>
<li class="chapter" data-level="2.1" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html#phn-1"><i class="fa fa-check"></i><b>2.1</b> Phần 1</a></li>
<li class="chapter" data-level="2.2" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html#phn-2"><i class="fa fa-check"></i><b>2.2</b> Phần 2</a></li>
<li class="chapter" data-level="2.3" data-path="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html"><a href="cac-phuong-phap-phan-tich-d-liu-thc-t-ng-dung-vi-r.html#phn-3"><i class="fa fa-check"></i><b>2.3</b> Phần 3</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><i class="fa fa-check"></i><b>3</b> Ngữ pháp của biến đổi dữ liệu với DPLYR</a><ul>
<li class="chapter" data-level="3.1" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#gii-thiu-v-pipe-operator"><i class="fa fa-check"></i><b>3.1</b> Giới thiệu về pipe operator</a></li>
<li class="chapter" data-level="3.2" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#cac-ham-co-ban-trong-dplyr"><i class="fa fa-check"></i><b>3.2</b> Các hàm cơ bản trong dplyr</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#nhom-cau-lnh-truy-vn-d-liu"><i class="fa fa-check"></i><b>3.2.1</b> Nhóm câu lệnh truy vấn dữ liệu</a></li>
<li class="chapter" data-level="3.2.2" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#nhom-cau-lnh-bin-i-d-liu"><i class="fa fa-check"></i><b>3.2.2</b> Nhóm câu lệnh biến đổi dữ liệu</a></li>
<li class="chapter" data-level="3.2.3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#nhom-ham-tng-hp-d-liu-vi-summarise"><i class="fa fa-check"></i><b>3.2.3</b> Nhóm hàm tổng hợp dữ liệu với <code>summarise</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#cac-ham-nang-cao-trong-dplyr"><i class="fa fa-check"></i><b>3.3</b> Các hàm nâng cao trong dplyr</a><ul>
<li class="chapter" data-level="3.3.1" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#iu-kin-phan-nhom-vi-case_when"><i class="fa fa-check"></i><b>3.3.1</b> Điều kiện phân nhóm với <code>case_when</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#tao-them-bin-mi-theo-iu-kin-vi-mutate_if-mutate_at"><i class="fa fa-check"></i><b>3.3.2</b> Tạo thêm biến mới theo điều kiện với <code>mutate_if</code> &amp; <code>mutate_at</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="ng-phap-cua-bin-i-d-liu-vi-dplyr.html"><a href="ng-phap-cua-bin-i-d-liu-vi-dplyr.html#tng-hp-d-liu-theo-iu-kin-vi-summarise_at-va-summarise_if"><i class="fa fa-check"></i><b>3.3.3</b> Tổng hợp dữ liệu theo điều kiện với <code>summarise_at</code> và <code>summarise_if</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html"><i class="fa fa-check"></i><b>4</b> Phân rã và xoay chiều dữ liệu</a><ul>
<li class="chapter" data-level="4.1" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#phan-ra-d-liu-thanh-dang-doc-vi-gather"><i class="fa fa-check"></i><b>4.1</b> Phân rã dữ liệu thành dạng dọc với <code>gather</code></a></li>
<li class="chapter" data-level="4.2" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#xoay-chiu-d-liu-vi-spread"><i class="fa fa-check"></i><b>4.2</b> Xoay chiều dữ liệu với <code>spread</code></a></li>
<li class="chapter" data-level="4.3" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#tach-mt-bin-thanh-nhiu-bin-vi-separate"><i class="fa fa-check"></i><b>4.3</b> Tách một biến thành nhiều biến với <code>separate</code></a></li>
<li class="chapter" data-level="4.4" data-path="phan-ra-va-xoay-chiu-d-liu.html"><a href="phan-ra-va-xoay-chiu-d-liu.html#gp-nhiu-bin-thanh-mt-bin-vi-unite"><i class="fa fa-check"></i><b>4.4</b> Gộp nhiều biến thành một biến với <code>unite</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html"><i class="fa fa-check"></i><b>5</b> Lập trình chức năng hàm với purrr</a><ul>
<li class="chapter" data-level="5.1" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#nhom-ham-map"><i class="fa fa-check"></i><b>5.1</b> Nhóm hàm map</a></li>
<li class="chapter" data-level="5.2" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#sa-i-gia-tri-vi-modify"><i class="fa fa-check"></i><b>5.2</b> Sửa đổi giá trị với <code>modify</code></a></li>
<li class="chapter" data-level="5.3" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#ng-dung"><i class="fa fa-check"></i><b>5.3</b> Ứng dụng</a><ul>
<li class="chapter" data-level="5.3.1" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#bin-i-d-liu-vi-modify-va-map_df"><i class="fa fa-check"></i><b>5.3.1</b> Biến đổi dữ liệu với <code>modify</code> và <code>map_df</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#phan-tich-nhiu-nhom-khac-nhau-cung-luc"><i class="fa fa-check"></i><b>5.3.2</b> Phân tích nhiều nhóm khác nhau cùng lúc</a></li>
<li class="chapter" data-level="5.3.3" data-path="lp-trinh-chc-nang-ham-vi-purrr.html"><a href="lp-trinh-chc-nang-ham-vi-purrr.html#phan-tich-nhiu-bin-trong-dataframe-cung-luc"><i class="fa fa-check"></i><b>5.3.3</b> Phân tích nhiều biến trong dataframe cùng lúc</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Machine Learning</b></span></li>
<li class="chapter" data-level="6" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html"><i class="fa fa-check"></i><b>6</b> Khái quát về học máy</a><ul>
<li class="chapter" data-level="6.1" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#gii-thiu"><i class="fa fa-check"></i><b>6.1</b> Giới thiệu</a></li>
<li class="chapter" data-level="6.2" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#quy-trinh-xay-dng-mo-hinh-d-bao"><i class="fa fa-check"></i><b>6.2</b> Quy trình xây dựng mô hình dự báo</a></li>
<li class="chapter" data-level="6.3" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#cac-nhom-thut-ng-cn-nh"><i class="fa fa-check"></i><b>6.3</b> Các nhóm thuật ngữ cần nhớ</a></li>
<li class="chapter" data-level="6.4" data-path="khai-quat-v-hoc-may.html"><a href="khai-quat-v-hoc-may.html#luu-y"><i class="fa fa-check"></i><b>6.4</b> Lưu ý</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html"><i class="fa fa-check"></i><b>7</b> Phân tích giỏ hàng</a><ul>
<li class="chapter" data-level="7.1" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#cac-khai-nim-co-ban"><i class="fa fa-check"></i><b>7.1</b> Các khái niệm cơ bản</a></li>
<li class="chapter" data-level="7.2" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#cach-thc-hin-mo-hinh"><i class="fa fa-check"></i><b>7.2</b> Cách thực hiện mô hình</a></li>
<li class="chapter" data-level="7.3" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#ba-cau-hoi-khi-phan-tich-gio-hang"><i class="fa fa-check"></i><b>7.3</b> Ba câu hỏi khi phân tích giỏ hàng</a><ul>
<li class="chapter" data-level="7.3.1" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#cac-san-phm-nao-hay-uc-mua-cung-nhau"><i class="fa fa-check"></i><b>7.3.1</b> Các sản phẩm nào hay được mua cùng nhau</a></li>
<li class="chapter" data-level="7.3.2" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#khach-hang-mua-san-phm-a-thi-se-mua-san-phm-nao-tip-theo"><i class="fa fa-check"></i><b>7.3.2</b> Khách hàng mua sản phẩm A thì sẽ mua sản phẩm nào tiếp theo?</a></li>
<li class="chapter" data-level="7.3.3" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#khach-hang-mua-san-phm-gi-thi-se-mua-tip-san-phm-a"><i class="fa fa-check"></i><b>7.3.3</b> Khách hàng mua sản phẩm gì thì sẽ mua tiếp sản phẩm A?</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="phan-tich-gio-hang.html"><a href="phan-tich-gio-hang.html#uu-nhuc-im"><i class="fa fa-check"></i><b>7.4</b> Ưu nhược điểm</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="feature-engineering.html"><a href="feature-engineering.html"><i class="fa fa-check"></i><b>8</b> Feature Engineering</a><ul>
<li class="chapter" data-level="8.1" data-path="feature-engineering.html"><a href="feature-engineering.html#feature-engineering-cho-cac-bin-nhom"><i class="fa fa-check"></i><b>8.1</b> Feature engineering cho các biến nhóm</a><ul>
<li class="chapter" data-level="8.1.1" data-path="feature-engineering.html"><a href="feature-engineering.html#tao-d-liu-gia-dummy-data-cho-bin-khong-phan-bit-th-t"><i class="fa fa-check"></i><b>8.1.1</b> Tạo dữ liệu giả (dummy data) cho biến không phân biệt thứ tự</a></li>
<li class="chapter" data-level="8.1.2" data-path="feature-engineering.html"><a href="feature-engineering.html#d-liu-co-rt-nhiu-nhom"><i class="fa fa-check"></i><b>8.1.2</b> Dữ liệu có rất nhiều nhóm</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="feature-engineering.html"><a href="feature-engineering.html#cac-bin-lien-tuc"><i class="fa fa-check"></i><b>8.2</b> Các biến liên tục</a><ul>
<li class="chapter" data-level="8.2.1" data-path="feature-engineering.html"><a href="feature-engineering.html#bin-i-11"><i class="fa fa-check"></i><b>8.2.1</b> Biến đổi 1:1</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Chuỗi thời gian</b></span></li>
<li class="chapter" data-level="9" data-path="gii-thiu-v-chui-thi-gian.html"><a href="gii-thiu-v-chui-thi-gian.html"><i class="fa fa-check"></i><b>9</b> Giới thiệu về chuỗi thời gian</a><ul>
<li class="chapter" data-level="9.1" data-path="gii-thiu-v-chui-thi-gian.html"><a href="gii-thiu-v-chui-thi-gian.html#thanh-phn-cua-chui-thi-gian"><i class="fa fa-check"></i><b>9.1</b> Thành phần của chuỗi thời gian</a></li>
</ul></li>
<li class="part"><span><b>V Case study</b></span></li>
<li class="chapter" data-level="10" data-path="trc-quan-hoa-d-liu.html"><a href="trc-quan-hoa-d-liu.html"><i class="fa fa-check"></i><b>10</b> Trực quan hóa dữ liệu</a><ul>
<li class="chapter" data-level="10.1" data-path="trc-quan-hoa-d-liu.html"><a href="trc-quan-hoa-d-liu.html#xay-dng-phu-ban-hang-theo-tng-nhom"><i class="fa fa-check"></i><b>10.1</b> Xây dựng phễu bán hàng theo từng nhóm</a></li>
<li class="chapter" data-level="10.2" data-path="trc-quan-hoa-d-liu.html"><a href="trc-quan-hoa-d-liu.html#ve-biu--warterfall-cho-aciveinactive-users"><i class="fa fa-check"></i><b>10.2</b> Vẽ biểu đồ warterfall cho acive/inactive users</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="more-to-say.html"><a href="more-to-say.html"><i class="fa fa-check"></i><b>A</b> More to Say</a></li>
<li class="chapter" data-level="" data-path="tai-liu-tham-khao.html"><a href="tai-liu-tham-khao.html"><i class="fa fa-check"></i>Tài liệu tham khảo</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Phân tích dữ liệu thực tế với R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="trc-quan-hoa-d-liu" class="section level1">
<h1><span class="header-section-number">Chương 10</span> Trực quan hóa dữ liệu</h1>
<div id="xay-dng-phu-ban-hang-theo-tng-nhom" class="section level2">
<h2><span class="header-section-number">10.1</span> Xây dựng phễu bán hàng theo từng nhóm</h2>
<p>Trong quá trình phân tích bán hàng, phếu bán hàng (sale funnel) là một kỹ thuật rất hữu dụng để trực quan hóa kết quả kinh doanh theo từng nhóm. Tuy nhiên, hiện ít có biểu đồ nào thể hiện được phễu bán hàng một cách hiệu quả trên R.</p>
<p>Trong mục này, tác giả sẽ hướng dẫn một ví dụ thực tiễn trực quan hóa phễu bán hàng một cách hiệu quả.</p>
<p>Xem ví dụ điển hình về phễu bán hàng dưới đây</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">textConnection</span>(</a>
<a class="sourceLine" id="cb186-2" data-line-number="2">          <span class="kw">c</span>(<span class="st">&quot;step;segment1;segment2;segment3;total</span></a>
<a class="sourceLine" id="cb186-3" data-line-number="3"><span class="st">          1_visit;1806;11663;12641;26110</span></a>
<a class="sourceLine" id="cb186-4" data-line-number="4"><span class="st">          2_register;1143;6476;5372;12991</span></a>
<a class="sourceLine" id="cb186-5" data-line-number="5"><span class="st">          3_login;1806;11663;2694;16163</span></a>
<a class="sourceLine" id="cb186-6" data-line-number="6"><span class="st">          4_subscribe;21;3322;2694;6037</span></a>
<a class="sourceLine" id="cb186-7" data-line-number="7"><span class="st">          5_paid;259;422;41;722&quot;</span>)),</a>
<a class="sourceLine" id="cb186-8" data-line-number="8">        <span class="dt">header =</span> T, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</a>
<a class="sourceLine" id="cb186-9" data-line-number="9"><span class="co"># Dữ liệu</span></a>
<a class="sourceLine" id="cb186-10" data-line-number="10">data</a></code></pre></div>
<pre><code>##                    step segment1 segment2 segment3
## 1               1_visit     1806    11663    12641
## 2            2_register     1143     6476     5372
## 3               3_login     1806    11663     2694
## 4           4_subscribe       21     3322     2694
## 5                5_paid      259      422       41
##   total
## 1 26110
## 2 12991
## 3 16163
## 4  6037
## 5   722</code></pre>
<p>Trong tập dữ liệu trên, ta sẽ mô phỏng dữ liệu phếu bán hàng của 3 phân khúc khách hàng trên một trang thương mại điện tử mà trong đó, khách hàng sẽ đi qua năm bước khác nhau:</p>
<ul>
<li>Ghé thăm website (visit)</li>
<li>Đăng ký (register)</li>
<li>Đăng nhập (login)</li>
<li>Đăng ký cập nhật các thông tin sản phẩm (subscribe)</li>
<li>Mua hàng và trả tiền thành công (paid)</li>
</ul>
<p>Để tạo một biểu đồ phễu bán hàng, ta sẽ thực hiện 3 bước lớn sau.</p>
<ul>
<li>Tạo <code>theme</code> cho biểu đồ</li>
<li>Tạo các biểu đồ con cho phễu bán hàng</li>
<li>Kết hợp các biểu đồ để tạo thành phễu bán hàng hoàn chỉnh</li>
</ul>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1"><span class="co"># Gọi library</span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb188-4" data-line-number="4"><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb188-5" data-line-number="5"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb188-6" data-line-number="6"></a>
<a class="sourceLine" id="cb188-7" data-line-number="7"><span class="co"># Tạo theme trông cho chart</span></a>
<a class="sourceLine" id="cb188-8" data-line-number="8">funnel_theme &lt;-<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb188-9" data-line-number="9">        <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb188-10" data-line-number="10">        <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb188-11" data-line-number="11">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb188-12" data-line-number="12">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb188-13" data-line-number="13">        )</a>
<a class="sourceLine" id="cb188-14" data-line-number="14"></a>
<a class="sourceLine" id="cb188-15" data-line-number="15"><span class="co"># Phân rã dữ liệu</span></a>
<a class="sourceLine" id="cb188-16" data-line-number="16">df &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="st">&quot;step&quot;</span>)</a>
<a class="sourceLine" id="cb188-17" data-line-number="17"></a>
<a class="sourceLine" id="cb188-18" data-line-number="18"><span class="co"># Tạo biểu đồ chính</span></a>
<a class="sourceLine" id="cb188-19" data-line-number="19">p1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-20" data-line-number="20"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">step =</span> <span class="kw">fct_rev</span>(step)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-21" data-line-number="21"><span class="st">  </span><span class="kw">filter</span>(variable <span class="op">!=</span><span class="st"> &quot;total&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-22" data-line-number="22"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(step, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-24" data-line-number="24"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>variable, <span class="dt">scale =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-25" data-line-number="25"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> value),</a>
<a class="sourceLine" id="cb188-27" data-line-number="27">            <span class="dt">position =</span> <span class="kw">position_stack</span>(<span class="dt">vjust =</span> <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-28" data-line-number="28"><span class="st">  </span><span class="kw">scale_fill_tableau</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb188-29" data-line-number="29"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb188-30" data-line-number="30"><span class="st">  </span><span class="kw">scale_y_sqrt</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb188-31" data-line-number="31"><span class="st">  </span>funnel_theme <span class="op">+</span></a>
<a class="sourceLine" id="cb188-32" data-line-number="32"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.margin=</span>grid<span class="op">::</span><span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">&quot;mm&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-33" data-line-number="33"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb188-34" data-line-number="34">  <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb188-35" data-line-number="35">  <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>, </a>
<a class="sourceLine" id="cb188-36" data-line-number="36">                            <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-37" data-line-number="37"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb188-38" data-line-number="38">    <span class="dt">panel.spacing =</span> <span class="kw">unit</span>(<span class="dv">0</span>, <span class="st">&quot;mm&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-39" data-line-number="39"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="dt">xmin =</span> <span class="fl">0.5</span>, <span class="dt">xmax =</span> <span class="fl">1.5</span>, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>,</a>
<a class="sourceLine" id="cb188-40" data-line-number="40">           <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-41" data-line-number="41"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="dt">xmin =</span> <span class="fl">2.5</span>, <span class="dt">xmax =</span> <span class="fl">3.5</span>, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>,</a>
<a class="sourceLine" id="cb188-42" data-line-number="42">           <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-43" data-line-number="43"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="dt">xmin =</span> <span class="fl">4.5</span>, <span class="dt">xmax =</span> <span class="fl">5.5</span>, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>,</a>
<a class="sourceLine" id="cb188-44" data-line-number="44">           <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-45" data-line-number="45"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb188-46" data-line-number="46">p1</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<ul>
<li>Tạo thêm phần <code>label</code> tổng theo từng segment</li>
</ul>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">step =</span> <span class="kw">fct_rev</span>(step)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(variable <span class="op">==</span><span class="st"> &quot;total&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(step, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb189-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">label =</span> value),</a>
<a class="sourceLine" id="cb189-6" data-line-number="6">             <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>,</a>
<a class="sourceLine" id="cb189-7" data-line-number="7">             <span class="dt">fill =</span> <span class="st">&quot;darkred&quot;</span>,</a>
<a class="sourceLine" id="cb189-8" data-line-number="8">             <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb189-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb189-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>variable) <span class="op">+</span></a>
<a class="sourceLine" id="cb189-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb189-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb189-13" data-line-number="13"><span class="st">  </span>funnel_theme <span class="op">+</span></a>
<a class="sourceLine" id="cb189-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb189-15" data-line-number="15">    <span class="dt">strip.text.x =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb189-16" data-line-number="16">  ) -&gt;<span class="st"> </span>p2</a>
<a class="sourceLine" id="cb189-17" data-line-number="17">p2</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<ul>
<li>Tạo thêm thứ tự các bước trong phễu bán hàng để dễ theo dõi hơn</li>
</ul>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">step =</span> data<span class="op">$</span>step,</a>
<a class="sourceLine" id="cb190-2" data-line-number="2">                  <span class="dt">value =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb190-3" data-line-number="3">df2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb190-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">step =</span> <span class="kw">fct_rev</span>(step)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb190-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(step, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="st">&quot;darkgreen&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> value), </a>
<a class="sourceLine" id="cb190-9" data-line-number="9">            <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb190-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb190-12" data-line-number="12"><span class="st">  </span>funnel_theme <span class="op">+</span></a>
<a class="sourceLine" id="cb190-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb190-14" data-line-number="14">    <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>)</a>
<a class="sourceLine" id="cb190-15" data-line-number="15">  ) -&gt;<span class="st"> </span>p3</a>
<a class="sourceLine" id="cb190-16" data-line-number="16">p3</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<ul>
<li>Cuối cùng, ta có thể tạo ghép các biểu đồ rời rạc để tạo thành phễu bán hàng hoàn chỉnh. Việc kết hợp các biểu đồ trên <code>ggplot2</code> có thể hoàn thành một cách đơn giản với <code>ggplot2</code></li>
</ul>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1"><span class="co">#devtools::install_github(&quot;thomasp85/patchwork&quot;)</span></a>
<a class="sourceLine" id="cb191-2" data-line-number="2"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb191-3" data-line-number="3">p3 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Sale funnel for 3 segments&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-5" data-line-number="5"><span class="st">  </span>p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-6" data-line-number="6"><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>))</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>Như vậy, chúng ta đã hoàn thành phễu bán hàng rất chuyên nghiệp với <code>ggplot2</code>. Phễu bán hàng này đặc biệt hiệu quả khi cùng lúc phải so sánh nhiều phân khúc khách hàng khác nhau trên toàn bộ chuỗi bán hàng.</p>
</div>
<div id="ve-biu--warterfall-cho-aciveinactive-users" class="section level2">
<h2><span class="header-section-number">10.2</span> Vẽ biểu đồ warterfall cho acive/inactive users</h2>
<p>Trong kỷ nguyên số, chỉ số <code>active user</code> (tạm dịch: người dùng thường xuyên hoạt động) là chỉ số đặc biệt quan trọng với bất kỳ website/ app nào. Công thức tính chỉ số người dùng thường xuyên hoạt động tại khoảng thời gian <em>t</em> được tính như sau:</p>
<p><span class="math display">\[active_{t} = active_{t-1} + new_{t} - churn_{t}\]</span></p>
<p>Ví dụ về waterfall chart được lấy từ ví dụ của Tableau tại đường link: [<a href="https://public.tableau.com/views/CH24_BBOD_ChurnTurnover/SubscriberChurnAnalysis" class="uri">https://public.tableau.com/views/CH24_BBOD_ChurnTurnover/SubscriberChurnAnalysis</a>]</p>
<p>Trong case study này, chúng ta sẽ tìm cách xây dựng một biểu đồ waterfall chart tương tự</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1"><span class="co"># Load library</span></a>
<a class="sourceLine" id="cb192-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb192-3" data-line-number="3"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb192-4" data-line-number="4"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb192-5" data-line-number="5"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb192-6" data-line-number="6"><span class="kw">library</span>(grid)</a>
<a class="sourceLine" id="cb192-7" data-line-number="7"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb192-8" data-line-number="8"></a>
<a class="sourceLine" id="cb192-9" data-line-number="9"><span class="co"># Tạo dữ liệu giả lập</span></a>
<a class="sourceLine" id="cb192-10" data-line-number="10"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb192-11" data-line-number="11">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">date =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">372</span>, <span class="dt">by =</span> <span class="dv">31</span>) <span class="op">%&gt;%</span><span class="st"> </span>as_date)</a>
<a class="sourceLine" id="cb192-12" data-line-number="12">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">new =</span> <span class="kw">abs</span>(<span class="kw">rnorm</span>(<span class="dv">12</span>, <span class="dv">100</span>, <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">churn =</span> <span class="kw">abs</span>(<span class="kw">rnorm</span>(<span class="dv">12</span>, <span class="dv">50</span>, <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">net =</span> new <span class="op">-</span><span class="st"> </span>churn)  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">eop =</span> <span class="kw">cumsum</span>(net)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb192-17" data-line-number="17"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>net)</a>
<a class="sourceLine" id="cb192-18" data-line-number="18"></a>
<a class="sourceLine" id="cb192-19" data-line-number="19">data</a></code></pre></div>
<pre><code>##          date new churn eop
## 1  1970-01-02  94    62  32
## 2  1970-02-02  98    53  77
## 3  1970-03-05 116    33 160
## 4  1970-04-05 101   104 157
## 5  1970-05-06 101    65 193
## 6  1970-06-06 117     9 301
## 7  1970-07-07 105    71 335
## 8  1970-08-07  87    36 386
## 9  1970-09-07  93    18 461
## 10 1970-10-08  96    43 514
## 11 1970-11-08 112    19 607
## 12 1970-12-09 104    28 683</code></pre>
<p>Trong ví dụ này, dữ liệu được tạo ngẫu nhiên sao cho số lượng <code>active user</code> cuối kỳ (eop - end of period) bằng với số cuối kỳ trước, thêm số lượng mới và trừ đi lượng khách hàng rời bỏ (<code>churn</code>).</p>
<p>Để tạo waterfall chart, ta có thể sử dụng <code>geom_segment</code> trong ggplot2</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1"><span class="co"># Xác định độ rộng của segment</span></a>
<a class="sourceLine" id="cb194-2" data-line-number="2">step &lt;-<span class="st"> </span><span class="fl">0.4</span><span class="op">*</span>(<span class="kw">max</span>(data<span class="op">$</span>date) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(data<span class="op">$</span>date))<span class="op">/</span>(<span class="kw">nrow</span>(data) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb194-3" data-line-number="3"></a>
<a class="sourceLine" id="cb194-4" data-line-number="4"><span class="co"># Xác định ymax</span></a>
<a class="sourceLine" id="cb194-5" data-line-number="5">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ymax =</span> eop <span class="op">+</span><span class="st"> </span>churn)</a>
<a class="sourceLine" id="cb194-7" data-line-number="7"></a>
<a class="sourceLine" id="cb194-8" data-line-number="8"><span class="co"># Xác định ymin</span></a>
<a class="sourceLine" id="cb194-9" data-line-number="9">df &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-10" data-line-number="10"><span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;eop&quot;</span>, <span class="st">&quot;ymax&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ymin =</span> ymax <span class="op">-</span><span class="st"> </span>value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-12" data-line-number="12"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">group =</span> variable)</a>
<a class="sourceLine" id="cb194-13" data-line-number="13"></a>
<a class="sourceLine" id="cb194-14" data-line-number="14"><span class="co"># Xác định xmin và xmax</span></a>
<a class="sourceLine" id="cb194-15" data-line-number="15">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xmin =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb194-17" data-line-number="17">    group <span class="op">==</span><span class="st"> &quot;new&quot;</span> <span class="op">~</span><span class="st"> </span>date <span class="op">-</span><span class="st"> </span>step,</a>
<a class="sourceLine" id="cb194-18" data-line-number="18">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>date </a>
<a class="sourceLine" id="cb194-19" data-line-number="19">  )) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-20" data-line-number="20"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xmax =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb194-21" data-line-number="21">    group <span class="op">==</span><span class="st"> &quot;new&quot;</span> <span class="op">~</span><span class="st"> </span>date,</a>
<a class="sourceLine" id="cb194-22" data-line-number="22">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>step</a>
<a class="sourceLine" id="cb194-23" data-line-number="23">  ))</a>
<a class="sourceLine" id="cb194-24" data-line-number="24"></a>
<a class="sourceLine" id="cb194-25" data-line-number="25"></a>
<a class="sourceLine" id="cb194-26" data-line-number="26"><span class="co"># Create waterfall chart</span></a>
<a class="sourceLine" id="cb194-27" data-line-number="27">p1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-28" data-line-number="28"><span class="st">  </span><span class="kw">arrange</span>(date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-29" data-line-number="29"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb194-30" data-line-number="30"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> xmin,</a>
<a class="sourceLine" id="cb194-31" data-line-number="31">                <span class="dt">xmax =</span> xmax,</a>
<a class="sourceLine" id="cb194-32" data-line-number="32">                <span class="dt">ymin =</span> ymin,</a>
<a class="sourceLine" id="cb194-33" data-line-number="33">                <span class="dt">ymax =</span> ymax,</a>
<a class="sourceLine" id="cb194-34" data-line-number="34">                <span class="dt">fill =</span> group))</a>
<a class="sourceLine" id="cb194-35" data-line-number="35">p1</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>Như vậy, ta đã tạo xong biểu đồ water-fall đơn giản. Ở bước tiếp theo, chúng ta cần điều chỉnh lại các thành phần cho biểu đồ.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1"><span class="co"># Tạo dữ liệu cho biểu đồ đường</span></a>
<a class="sourceLine" id="cb195-2" data-line-number="2">df2 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(date, eop) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>()</a>
<a class="sourceLine" id="cb195-3" data-line-number="3"></a>
<a class="sourceLine" id="cb195-4" data-line-number="4"><span class="co"># Điều chỉnh theme</span></a>
<a class="sourceLine" id="cb195-5" data-line-number="5">p2 &lt;-<span class="st"> </span>p1  <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb195-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(date, eop), <span class="dt">col =</span> <span class="st">&quot;dodgerblue4&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(date, eop), <span class="dt">col =</span> <span class="st">&quot;dodgerblue4&quot;</span>, <span class="dt">size =</span> <span class="fl">2.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(date, eop, <span class="dt">label =</span> eop), <span class="dt">vjust =</span> <span class="fl">1.2</span>, </a>
<a class="sourceLine" id="cb195-9" data-line-number="9">            <span class="dt">hjust =</span> <span class="fl">-0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;grey60&quot;</span>, <span class="st">&quot;coral2&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb195-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb195-13" data-line-number="13">    <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;gray40&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>),</a>
<a class="sourceLine" id="cb195-14" data-line-number="14">    <span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">breaks =</span> data<span class="op">$</span>date,</a>
<a class="sourceLine" id="cb195-16" data-line-number="16">               <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb195-18" data-line-number="18">        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-19" data-line-number="19"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Overview of active users&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb195-20" data-line-number="20"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb195-21" data-line-number="21"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Number of active users&quot;</span>)</a>
<a class="sourceLine" id="cb195-22" data-line-number="22">p2</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>Bước tiếp theo, ta cần xây dựng biểu đồ bar đơn giản để có thể đưa vào góc phần tư bên trái của biểu đồ vừa tạo.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1">p3 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb196-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb196-3" data-line-number="3">    group <span class="op">==</span><span class="st"> &quot;churn&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>value,</a>
<a class="sourceLine" id="cb196-4" data-line-number="4">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>value</a>
<a class="sourceLine" id="cb196-5" data-line-number="5">  )) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb196-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb196-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> group), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb196-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;grey60&quot;</span>, <span class="st">&quot;coral2&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb196-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb196-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb196-11" data-line-number="11">    <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb196-12" data-line-number="12">    <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb196-13" data-line-number="13">    <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb196-14" data-line-number="14">    <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb196-15" data-line-number="15">    <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb196-16" data-line-number="16">    <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb196-17" data-line-number="17">    <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb196-18" data-line-number="18">    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>)</a>
<a class="sourceLine" id="cb196-19" data-line-number="19">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb196-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">breaks =</span> data<span class="op">$</span>date,</a>
<a class="sourceLine" id="cb196-21" data-line-number="21">               <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>) </a>
<a class="sourceLine" id="cb196-22" data-line-number="22">p3</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>Cuối cùng, ta có thể nhóm hai biểu đồ trên với <code>grid</code> &amp; <code>gridExtra</code>.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1"><span class="kw">grid.newpage</span>()</a>
<a class="sourceLine" id="cb197-2" data-line-number="2"></a>
<a class="sourceLine" id="cb197-3" data-line-number="3"><span class="co"># Xác định vị trí cho biểu đồ chính</span></a>
<a class="sourceLine" id="cb197-4" data-line-number="4">position_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">viewport</span>(<span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">height =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb197-5" data-line-number="5">                       <span class="dt">x =</span> <span class="fl">0.5</span>, <span class="dt">y =</span> <span class="fl">0.5</span>)  </a>
<a class="sourceLine" id="cb197-6" data-line-number="6"></a>
<a class="sourceLine" id="cb197-7" data-line-number="7"><span class="co"># Vị trí cho biểu đồ phụ</span></a>
<a class="sourceLine" id="cb197-8" data-line-number="8">position_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">viewport</span>(<span class="dt">width =</span> <span class="fl">0.35</span>, <span class="dt">height =</span> <span class="fl">0.25</span>, </a>
<a class="sourceLine" id="cb197-9" data-line-number="9">                       <span class="dt">x =</span> <span class="fl">0.25</span>, <span class="dt">y =</span> <span class="fl">0.75</span>)  </a>
<a class="sourceLine" id="cb197-10" data-line-number="10"></a>
<a class="sourceLine" id="cb197-11" data-line-number="11"><span class="kw">print</span>(p2, <span class="dt">vp =</span> position_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb197-12" data-line-number="12"><span class="kw">print</span>(p3, <span class="dt">vp =</span> position_<span class="dv">2</span>)</a></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>


</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="gii-thiu-v-chui-thi-gian.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="more-to-say.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/71-casestudy-truc-quan-hoa.Rmd",
"text": "Edit"
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
